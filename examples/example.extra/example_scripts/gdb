#! /bin/bash
KERNEL="$HOME/kernel/compiled/vmlinux"
MODULES_DIR="$HOME/testing/mkosi.extra/modules"
COMMAND=""

#Options:
#k - Kernel name (relative to SOURCE_DIR)
#m - module location (relative to $HOME)
#s - Source Directory (can generally be thought of as the kernel build dir)
#    relative to ($HOME/kernel)

OPTSTRING="k:m:h"

while getopts ${OPTSTRING} opt; do
	case ${opt} in
		k)
			KERNEL=${OPTARG}
			;;
		m)
			MODULES_DIR=${OPTARG}
			;;
		h)
			printf "k : KERNEL\nm : MODULES_DIR\n"
			echo "See file for more details"
			exit
			;;
	esac
done

echo $KERNEL

#MAKE SURE that we have /[USER]/.config/gdb/gdbinit
#with add-auto-load-safe-path /[safepath]
COMMAND="gdb \
	'$KERNEL' -q -tui \
	-ex 'target remote localhost:1234' \
	-ex 'lx-symbols $MODULES_DIR' \
	-ex 'c'"
echo $COMMAND
eval $COMMAND
