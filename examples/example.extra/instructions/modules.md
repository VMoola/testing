# Using custom modules for kernel functionality

If we ever want to build modules, ON TOP of the basic debugging kernel
requirements, we will then also need the following:
```
Module.Symvers      - Generated by MODPOST in 'make modules'
scripts/            - present by default
tools/              - present by default
Makefile            - present by default
```

Having these files will let us build external modules that can be hotplugged.

Then look at the files for examples:
```
modules_example/device.c
example_scripts/device_example.c

# It also makes sense to disable CONFIG_LOCALVERSION_AUTO when building the
# kernel. Doing so streamlines the process by providing meaningful details
# about whether we need to recompile the kernel, module, or Module.Symvers.
```

When dealing with device ioctls, we can simply find a value that is NOT being
used already. This becomes undefined behavior if we try to override one, so
make sure to check.

# Installing

```
To install our module, we have a few steps:
1) mount the image
2) make modules_install INSTALL_MOD_PATH=[mounted_image]
3) cp [module_path].ko [mounted_image]/lib/modules/[version]/extra/[module].ko
4) depmod inside the vm

// Optional - for automatically loading module on subsequent boots:
5) add [module_name] to any file in /etc/modprobe.d/[file].conf
```
